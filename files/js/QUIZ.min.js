if(!QUIZ){var QUIZ={}}QUIZ.Quiz=Class.extend({_proxy:null,_actionName:null,_quizID:0,_quizText:"",_quizTitle:"",_questions:null,_questionCount:0,_currentIndex:0,_correctAnswers:null,_showBest:1,_showStats:1,_showCorrect:0,_showResult:0,_showComment:0,_uniqueID:"",_beforeQuiz:"",_afterQuiz:"",_userCorrect:null,_userIncorrect:null,_userSelect:[],_resultText:"",_resultComment:"",_paused:"",_intervalID:0,_timeLimit:0,_dialog:null,_displayed:0,init:function(){$("#quizSubmitContainer").hide();$("#quizContainer").hide();$("#afterQuiz").hide();this._actionName="";this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(".quizButton").click($.proxy(this._startQuiz,this));$(".statsButton").click($.proxy(this._statQuiz,this));$(".bestButton").click($.proxy(this._bestQuiz,this));$("#quizSaveButton").click($.proxy(this._quizSaveButton,this));$("#quizNextButton").click($.proxy(this._quizNextButton,this));$("#quizAbortButton").click($.proxy(this._quizAbortButton,this));$("#quizStatsButton").click($.proxy(this._quizStatsButton,this));$("#quizBestButton").click($.proxy(this._quizBestButton,this));$("#quizResultButton").click($.proxy(this._quizResultButton,this));$("#quizOverviewButton").click($.proxy(this._quizOverviewButton,this))},_statQuiz:function(a){a.preventDefault();this._quizID=$(a.currentTarget).data("objectID");var b=new WCF.User.List("wcf\\data\\quiz\\QuizAction",WCF.Language.get("wcf.user.quiz.stats"),{data:{quizID:this._quizID,type:"stat"}});b.open()},_bestQuiz:function(a){a.preventDefault();this._quizID=$(a.currentTarget).data("objectID");var b=new WCF.User.List("wcf\\data\\quiz\\QuizAction",WCF.Language.get("wcf.user.quiz.best"),{data:{quizID:this._quizID,type:"best"}});b.open()},_quizResultButton:function(a){this._actionName="checkQuizResult";this._proxy.setOption("data",{actionName:"checkQuizResult",className:"wcf\\data\\quiz\\QuizAction",parameters:{quizID:this._quizID,current:this._currentIndex,uniqueID:this._uniqueID}});this._proxy.sendRequest()},_startQuiz:function(a){a.preventDefault();this._quizID=$(a.currentTarget).data("objectID");this._actionName="getQuiz";this._proxy.setOption("data",{actionName:"getQuiz",className:"wcf\\data\\quiz\\QuizAction",parameters:{quizID:this._quizID}});this._proxy.sendRequest();$(window).on("beforeunload",function(){return WCF.Language.get("wcf.user.quiz.browserAbort")})},_success:function(f,b,m){switch(this._actionName){case"getQuiz":this._quizTitle=f.returnValues.title;this._quizText=f.returnValues.text;this._timeLimit=parseInt(f.returnValues.timeLimit);this._showBest=parseInt(f.returnValues.showBest);this._showComment=parseInt(f.returnValues.showComment);this._showCorrect=parseInt(f.returnValues.showCorrect);this._showResult=parseInt(f.returnValues.showResult);this._showStats=parseInt(f.returnValues.showStats);this._uniqueID=f.returnValues.uniqueID;this._beforeQuiz=f.returnValues.beforeQuiz;this._afterQuiz=f.returnValues.afterQuiz;this._questions=f.returnValues.questions;this._questionCount=parseInt(this._questions.length);this._currentIndex=0;this._correctAnswers=0;this._userCorrect=[];this._userIncorrect=[];$("#quizListContainer").hide();$("#quizContainer").show();$("#afterQuiz").show();$("#quizTimer").hide();if(this._beforeQuiz.template!==undefined){$("#beforeQuiz").append(this._beforeQuiz.template)}$("#quizTitle").append(this._quizTitle);if(this._timeLimit){this._displayed=0;this._intervalID=setInterval($.proxy(this._executeTimer,this),1000);$("#quizTimer").show()}this._displayQuestion();if(this._afterQuiz.template!==undefined){$("#afterQuiz").append(this._afterQuiz.template)}break;case"saveResult":this._resultText=f.returnValues.result;this._resultComment=f.returnValues.comment;this._paused=f.returnValues.paused;$(window).unbind("beforeunload");this._displayResult();break;case"getComments":var k=f.returnValues.comments;var n=parseInt(f.returnValues.showResultButton);$("#question").remove();var e=$("<div>",{id:"question","class":"quizQuestion"});e.append($('<p class="quizResult">'+this._resultText+"</p>"));e.append($("<p>"+this._resultComment+"</p>"));if(this._paused){e.append($("<br><p>"+this._paused+"</p>"))}if(k.length>0){e.append($("<br>"))}for(var g=0;g<k.length;g++){e.append($("<p>"+k[g]+"</p>"))}$("#quiz").append(e);$("#quizAbortButton").hide();$("#quizNextButton").hide();if(n){$("#quizResultButton").show()}$("#quizSaveButton").hide();if(this._showStats){$("#quizStatsButton").show()}if(this._showBest){$("#quizBestButton").show()}$("#quizOverviewButton").show();$("#quizSubmitContainer").show();break;case"checkQuizResult":if(this._showCorrect&&this._showResult){var l=$("<div>",{"class":"section"});var d=0;l.append($('<h2 class="sectionTitle">'+WCF.Language.get("wcf.user.quiz.resultDialog.correct")+"</h2>"));if(this._userCorrect.length){for(var g=0;g<this._userCorrect.length;g++){d=this._userCorrect[g];d++;l.append($("<p>"+d+". "+this._questions[this._userCorrect[g]].question+"</p>"));var j=this._questions[this._userCorrect[g]].correct;j--;if(this._showCorrect){l.append($("<small>"+WCF.Language.get("wcf.user.quiz.correct")+" "+this._questions[this._userCorrect[g]].answers[this._questions[this._userCorrect[g]].correct]+"</small>"));l.append($("<br><br>"))}}}else{l.append($("<p>"+WCF.Language.get("wcf.user.quiz.resultDialog.none")+"</p>"))}var c=$("<div>",{"class":"section"});c.append($('<h2 class="sectionTitle">'+WCF.Language.get("wcf.user.quiz.resultDialog.wrong")+"</h2>"));if(this._userIncorrect.length){for(var g=0;g<this._userIncorrect.length;g++){d=this._userIncorrect[g];d++;c.append($("<p>"+d+". "+this._questions[this._userIncorrect[g]].question+"</p>"));var j=this._questions[this._userIncorrect[g]].correct;j--;if(this._showCorrect){c.append($("<small>"+WCF.Language.get("wcf.user.quiz.correct")+" "+this._questions[this._userIncorrect[g]].answers[this._questions[this._userIncorrect[g]].correct]+"</small>"));c.append($("<br><br>"))}}}else{c.append($("<p>"+WCF.Language.get("wcf.user.quiz.resultDialog.none")+"</p>"))}this._dialog=$("<div>").appendTo(document.body);this._dialog.append(l);this._dialog.append(c);this._dialog.wcfDialog({title:WCF.Language.get("wcf.user.quiz.result.your")})}else{if(this._showCorrect){var l=$("<div>",{"class":"section"});var d=0;l.append($('<h2 class="sectionTitle">'+WCF.Language.get("wcf.user.quiz.resultDialog.correct")+"</h2>"));if(this._correctAnswers==1){l.append($("<p>"+this._correctAnswers+" "+WCF.Language.get("wcf.user.quiz.question")+"</p>"))}else{if(this._correctAnswers>1){l.append($("<p>"+this._correctAnswers+" "+WCF.Language.get("wcf.user.quiz.questions")+"</p>"))}else{l.append($("<p>"+WCF.Language.get("wcf.user.quiz.resultDialog.none")+"</p>"))}}var c=$("<div>",{"class":"section"});c.append($('<h2 class="sectionTitle">'+WCF.Language.get("wcf.user.quiz.resultDialog.wrong")+"</h2>"));var h=this._questions.length-this._correctAnswers;if(h==1){c.append($("<p>"+h+" "+WCF.Language.get("wcf.user.quiz.question")+"</p>"))}else{if(h>1){c.append($("<p>"+h+" "+WCF.Language.get("wcf.user.quiz.questions")+"</p>"))}else{c.append($("<p>"+WCF.Language.get("wcf.user.quiz.resultDialog.none")+"</p>"))}}this._dialog=$("<div>").appendTo(document.body);this._dialog.append(l);this._dialog.append(c);this._dialog.wcfDialog({title:WCF.Language.get("wcf.user.quiz.result.your")})}else{if(this._showResult){var d=0;var l=$("<div>",{"class":"section"});l.append($('<h2 class="sectionTitle">'+WCF.Language.get("wcf.user.quiz.resultDialog.correct")+"</h2>"));l.append($("<p>"+WCF.Language.get("wcf.user.quiz.resultDialog.hide")+"</p>"));var c=$("<div>",{"class":"section"});c.append($('<h2 class="sectionTitle">'+WCF.Language.get("wcf.user.quiz.resultDialog.wrong")+"</h2>"));c.append($("<p>"+WCF.Language.get("wcf.user.quiz.resultDialog.hide")+"</p>"));var o=$("<div>",{"class":"section"});o.append($('<h2 class="sectionTitle">'+WCF.Language.get("wcf.user.quiz.resultDialog.result")+"</h2>"));for(var g=0;g<this._questions.length;g++){d=g+1;o.append($("<p>"+d+". "+this._questions[g].question+"</p>"));o.append($("<small>"+WCF.Language.get("wcf.user.quiz.correct")+" "+this._questions[g].answers[this._questions[g].correct]+"</small>"));o.append($("<br><br>"))}this._dialog=$("<div>").appendTo(document.body);this._dialog.append(l);this._dialog.append(c);this._dialog.append(o);this._dialog.wcfDialog({title:WCF.Language.get("wcf.user.quiz.result.your")})}else{var l=$("<div>",{"class":"section"});l.append($('<h2 class="sectionTitle">'+WCF.Language.get("wcf.user.quiz.resultDialog.correct")+"</h2>"));l.append($("<p>"+WCF.Language.get("wcf.user.quiz.resultDialog.hide")+"</p>"));var c=$("<div>",{"class":"section"});c.append($('<h2 class="sectionTitle">'+WCF.Language.get("wcf.user.quiz.resultDialog.wrong")+"</h2>"));c.append($("<p>"+WCF.Language.get("wcf.user.quiz.resultDialog.hide")+"</p>"));this._dialog=$("<div>").appendTo(document.body);this._dialog.append(l);this._dialog.append(c);this._dialog.wcfDialog({title:WCF.Language.get("wcf.user.quiz.result.your")})}}}break;case"getCorrect":var l=f.returnValues.correct;var a=f.returnValues.correctAnswer;$("#question").remove();var e=$("<div>",{id:"question","class":"quizQuestion"});e.append($('<p class="quizResultQuestion">'+this._questions[this._currentIndex]["question"]+"</p>"));if(l<0){e.append($('<p class="quizResultCorrect">'+WCF.Language.get("wcf.user.quiz.result.saved")+"</p>"))}else{if(l==0){if(this._showCorrect){e.append($('<p class="quizResultWrong">'+WCF.Language.get("wcf.user.quiz.result.wrong")+"</p>"))}else{e.append($('<p class="quizResultCorrect">'+WCF.Language.get("wcf.user.quiz.result.saved")+"</p>"))}}else{this._correctAnswers++;if(this._showCorrect){e.append($('<p class="quizResultCorrect">'+WCF.Language.get("wcf.user.quiz.result.correct")+"</p>"))}else{e.append($('<p class="quizResultCorrect">'+WCF.Language.get("wcf.user.quiz.result.saved")+"</p>"))}}}if(a>=0){e.append($("<p>"+WCF.Language.get("wcf.user.quiz.correct")+" "+this._questions[this._currentIndex].answers[a]+"</p>"));this._questions[this._currentIndex].correct=a;if(l>0){this._userCorrect.push(parseInt(this._currentIndex))}else{this._userIncorrect.push(parseInt(this._currentIndex))}}if(this._showComment){if(this._showResult){e.append($("<br>"))}e.append($("<p>"+this._questions[this._currentIndex].comment+"</p>"))}$("#quiz").append(e);$("#quizSaveButton").hide();$("#quizNextButton").show();break}},_executeTimer:function(){this._timeLimit--;if(this._timeLimit>0){var b=parseInt(this._timeLimit,10);var a=Math.floor(b/3600);var d=Math.floor((b-(a*3600))/60);var e=b-(a*3600)-(d*60);if(a<10){a="0"+a}if(d<10){d="0"+d}if(e<10){e="0"+e}$("#quizTimerValue").text(a+":"+d+":"+e)}else{$("#quizTimerValue").text("00:00:00")}if(this._timeLimit<1&&this._displayed==0){if(this._dialog!==null){this._dialog.wcfDialog("close")}$("#quizTimerValue").addClass("quizQuestionTimerElapsed");this._displayed=1;this._dialog=$('<header class="boxHeadline"><strong>'+WCF.Language.get("wcf.user.quiz.timeExpired")+"</strong></header>").wcfDialog({title:WCF.Language.get("wcf.user.quiz.timeExpired.title"),closeViaModal:false})}if(this._timeLimit<-3){this._dialog.wcfDialog("close");clearInterval(this._intervalID);for(var c=this._currentIndex;c<this._questionCount;c++){this._userIncorrect.push(parseInt(c))}this._currentIndex=this._questionCount;$("#quizNextButton").click()}},_displayQuestion:function(){var d=this._currentIndex;d++;$("#quizNextButton").removeAttr("disabled");$("#question").remove();var c=window.screen.width;if(c<this._questions[this._currentIndex]["maxLen"]){var a=$("<div>",{id:"question","class":"quizQuestion quizQuestionBreak"})}else{var a=$("<div>",{id:"question","class":"quizQuestion"})}a.append($('<p class="quizQuestionCount">'+WCF.Language.get("wcf.user.quiz.question")+" "+d+"/"+this._questionCount+" <small>"+this._questions[this._currentIndex]["author"]+"</small></p>"));a.append($('<p class="quizQuestionQuestion">'+this._questions[this._currentIndex]["question"]+"</p>"));if(this._questions[this._currentIndex]["image"]){a.append($('<p class="quizQuestionImage framed"><img src="'+this._questions[this._currentIndex]["image"]+' " alt=""></img></p>'))}for(var b=0;b<this._questions[this._currentIndex].answers.length;b++){a.append($('<div><span><input id="ans'+b+'" type="radio" name="answer" value='+b+' /></span> <label for="ans'+b+'">'+this._questions[this._currentIndex].answers[b]+"</label></div>"))}$("#quiz").append(a);$("#quizAbortButton").show();$("#quizNextButton").hide();$("#quizResultButton").hide();$("#quizSaveButton").show();$("#quizStatsButton").hide();$("#quizBestButton").hide();$("#quizSubmitContainer").show();$("#quizOverviewButton").hide()},_quizSaveButton:function(){var a=$('input[name="answer"]:checked').val();if(!a){this._dialog=$('<header class="boxHeadline"><strong>'+WCF.Language.get("wcf.user.quiz.error.noSelection")+"</strong></header>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});return}if(1==this._questionCount-this._currentIndex){clearInterval(this._intervalID);$("#quizTimerValue").addClass("quizQuestionTimerNotElapsed")}this._userSelect[this._currentIndex]=[this._questions[this._currentIndex]["id"],a];this._actionName="getCorrect";this._proxy.setOption("data",{actionName:"getCorrect",className:"wcf\\data\\quiz\\QuizAction",parameters:{questionID:this._questions[this._currentIndex]["id"],selected:a,showCorrect:this._showCorrect,showResult:this._showResult,quizID:this._quizID,uniqueID:this._uniqueID}});this._proxy.sendRequest()},_quizNextButton:function(){$("#quizNextButton").attr("disabled","disabled");this._currentIndex++;if(this._currentIndex<this._questionCount){this._displayQuestion()}else{clearInterval(this._intervalID);this._saveResult()}},_quizAbortButton:function(){WCF.System.Confirmation.show(WCF.Language.get("wcf.user.quiz.abortConfirm"),function(a){if(a==="confirm"){$(window).unbind("beforeunload");window.location.reload()}})},_quizOverviewButton:function(){$(window).unbind("beforeunload");window.location.reload()},_quizStatsButton:function(){var a=new WCF.User.List("wcf\\data\\quiz\\QuizAction",WCF.Language.get("wcf.user.quiz.stats"),{data:{quizID:this._quizID,type:"stat"}});a.open()},_quizBestButton:function(){var a=new WCF.User.List("wcf\\data\\quiz\\QuizAction",WCF.Language.get("wcf.user.quiz.best"),{data:{quizID:this._quizID,type:"best"}});a.open()},_saveResult:function(){this._actionName="saveResult";this._proxy.setOption("data",{actionName:"saveResult",className:"wcf\\data\\quiz\\QuizAction",parameters:{quizID:this._quizID,showCorrect:this._showCorrect,showResult:this._showResult,correctAnswers:this._correctAnswers,uniqueID:this._uniqueID,questionCount:this._questionCount,userSelect:this._userSelect}});this._proxy.sendRequest()},_displayResult:function(){this._actionName="getComments";this._proxy.setOption("data",{actionName:"getComments",className:"wcf\\data\\quiz\\QuizAction",parameters:{quizID:this._quizID}});this._proxy.sendRequest()}});QUIZ.MarkAllAsRead=Class.extend({_proxy:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(".markAllAsReadButton").click($.proxy(this._click,this))},_click:function(a){a.preventDefault();this._proxy.setOption("data",{actionName:"markAllAsRead",className:"wcf\\data\\quiz\\QuizAction"});this._proxy.sendRequest()},_success:function(c,d,b){$(".mainMenu .active .badge").hide();var a=new WCF.System.Notification(WCF.Language.get("wcf.global.success"),"success");a.show()}});QUIZ.Rating=Class.extend({_buttons:{},_dialog:null,_notification:null,_quizID:0,_proxy:null,init:function(){this._buttons={};this._notification=null;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(".rateButton").click($.proxy(this._click,this));$(".ratingDetails").click($.proxy(this._ratingDetails,this))},_click:function(a){this._quizID=$(a.currentTarget).data("objectID");this._proxy.setOption("data",{actionName:"prepareRating",className:"wcf\\data\\quiz\\rating\\RatingAction",parameters:{quizID:this._quizID}});this._proxy.sendRequest()},_ratingDetails:function(a){this._quizID=$(a.currentTarget).data("objectID");var b=new WCF.User.List("wcf\\data\\quiz\\rating\\RatingAction",WCF.Language.get("wcf.user.quiz.rating.details"),{data:{quizID:this._quizID}});b.open()},_success:function(b,d,a){this._notification=null;if(b.returnValues.rated){var c=b.returnValues.rated;if(c>0){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.user.quiz.rating.rate.success"))}else{this._notification=new WCF.System.Notification(WCF.Language.get("wcf.user.quiz.rating.unrate.success"))}this._dialog.wcfDialog("close");this._notification.show();window.location.reload()}else{if(b.returnValues.template){this._showDialog(b.returnValues.template);this._dialog.find(".jsSubmitRating").click($.proxy(this._submit,this));this._dialog.find(".jsDeleteRating").click($.proxy(this._delete,this));this._dialog.find(".jsAbortRating").click($.proxy(this._abort,this))}}},_showDialog:function(a){if(this._dialog===null){this._dialog=$("#rating");if(!this._dialog.length){this._dialog=$('<div id="rating" />').hide().appendTo(document.body)}}this._dialog.html(a).wcfDialog({title:WCF.Language.get("wcf.user.quiz.rating")}).wcfDialog("render")},_abort:function(){this._dialog.wcfDialog("close")},_submit:function(){var a=this._dialog.find("input[type=radio]:checked").val();if(a!==undefined){this._proxy.setOption("data",{actionName:"rate",className:"wcf\\data\\quiz\\rating\\RatingAction",parameters:{rating:a,quizID:this._quizID}});this._proxy.sendRequest()}},_delete:function(){this._proxy.setOption("data",{actionName:"unrate",className:"wcf\\data\\quiz\\rating\\RatingAction",parameters:{quizID:this._quizID}});this._proxy.sendRequest()}});